- page = Poc::PagePresenter.new(@content)
- page.add_breadcrumb_current('Submitting proposal')

.process
  .container
    = render partial: "components/breadcrumbs", locals: { breadcrumbs: page.breadcrumbs }

    %h1
      %span.progress You are submitting a proposal for
      = @opportunity.title

    = form_for @enquiry do |f|
      %p.intro.description
        All fields are required unless marked as optional.

      %fieldset.details
        %legend Your Details
        .field
          = f.label :first_name, "First Name", class: "required"
          = f.text_field :first_name, required: "required"
        .field
          = f.label :last_name, "Last Name", class: "required"
          = f.text_field :last_name, required: "required"
        .field
          = f.label :company_telephone, "Telephone Number", class: "required"
          = f.text_field :company_telephone, class: "short-input", required: "required"

      %fieldset.business
        %legend About Your Business
        - if current_user&.saved_enquiry_data?
          .field{id: "companies-house-section"}
            = f.label :company_name, "Company Name", class: "required"
            = f.text_field :company_name, required: "required", class: "short-input"

          %div
            .field
              = f.label :company_house_number, "Companies House Number"
              = f.text_field :company_house_number
            .field
              = f.label :company_address, "Company Address", class: "required"
              = f.text_field :company_address, required: "required"
            .field
              = f.label :company_postcode, "Post Code", class: "required"
              = f.text_field :company_postcode, {class: "short-input", required: "required"}
            .field
              = f.label :company_url, "Company URL (optional)"
              = f.text_field :company_url

            - if trade_profile(@enquiry.company_house_number)
              %p
                = 'We have identified that you have a trade profile.'
              %p
                = 'Your'
                = link_to 'Trade Profile', trade_profile(@enquiry.company_house_number), target: :blank
                = 'will be added to your application.'
            - else
              %p
                no trade profile
        - else
          .field{id: "companies-house-section"}
            = f.label :company_name, "Company Name", class: "required"
            = f.text_field :company_name, required: "required", class: "short-input"
            %span.loadingIndicator
            %button{id: "ch_search", class: "button companies-house-search-btn", type: "button"} Search Companies House

            .field{id: "ch_search-results"}
              %ul.companies-house-list

          %div#no-companies-house-number-fields
            .field#company_house_number
              = f.label :company_house_number, "Companies House Number"
              = f.text_field :company_house_number, readonly: true
            .field
              = f.label :company_address, "Company Address", class: "required"
              = f.text_field :company_address, required: "required"
            .field
              = f.label :company_postcode, "Post Code", class: "required"
              = f.text_field :company_postcode, {class: "short-input", required: "required"}
            .field
              = f.label :company_url, "Company URL (optional)"
              = f.text_field :company_url

      %fieldset.your-exporting
        %legend About Your Exporting Experience
        .field
          = f.label :existing_exporter, "Have you sold products or services to overseas customers?", class: "required"
          = f.select(:existing_exporter, Enquiry::EXISTING_EXPORTER_CHOICES, required: "required", prompt: 'Select')
        .field
          = f.label :company_sector, "Select your sector", class: "required"
          = f.select(:company_sector, Sector.pluck(:name).to_a, required: "required", prompt: 'Sector')
        .field
          = f.label :company_explanation, "Explain what your company does and how it meets the requirements for this opportunity. This is your chance to promote your company and make your proposal stand out.", class: "required"
          = f.text_area :company_explanation, {required: "required", rows: "8"}

        .field.checkbox
          %input{:type=>"checkbox", :name=>"enquiry[data_protection]", :id=>"data-protection"}
          %label{:for=>"data-protection"}
            -#= f.check_box :data_protection
            = "I agree my details may be used for marketing by #{t('organisation.name')} and trusted partners (optional)"

      = f.submit 'Submit', class: 'button'
